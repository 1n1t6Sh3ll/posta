import React from "react";
import ReactDOM from "react-dom";
import Editor from "../components/editor";
import Layout from '../components/layout'
import "./options.scss";
import Header from '../components/header';
const {decode } = require('js-base64').Base64;

export default class App extends React.Component {
  captureEditorSession(session) {
    this.editorSession = session;
    let _urlSearch = new URLSearchParams(location.search);
    var code;
    try {
      code = decode(_urlSearch.get("code"));
      this.editorSession.setValue(code);
      this.editorSession.setMode({
        v: Date.now(),
        path: "ace/mode/json"
      })

    } catch (error) {
      console.error(error);
    }
  }

  openAsTab(target){
    this.targetWindow = window.open(target)
  }

  exploit(){
    this.targetWindow.postMessage(this.editorSession.getValue(),"*");
    window.frames[0].postMessage(this.editorSession.getValue(),"*");
  }

  render() {
    let _urlSearch = new URLSearchParams(location.search);
    var target;
    try {target = decode(_urlSearch.get("target"));} catch (error) {}
    // ;
    return <>
    
    <Header></Header>
    
    <div className="target head">{target}</div>
    <div style={{height:"calc(100% - 120px)"}}>
    <Layout layout={
      [
        {
          w: 40,
          h: 90,
          content: <div className="frames">
            <iframe style={{margin:"10px",width:"calc(100% - 20px)",height:"50%"}}  src={target}></iframe>
            <span>Iframe does not load? try<span className="open-tab-link" onClick={()=>this.openAsTab(target)}>Open as tab</span></span>
          </div>
        },
        {
          w: 40,
          h: 10,
          content: <div className="actions">
            <button onClick={()=>this.exploit()}>Exploit</button>
          </div>
        },
        {
          w: 60,
          h: 100,
          content: <div style={{ maxHeight: "100%", backgroundColor: "#000000", height: "100%" }}>
            <Editor style={{ height: "100%", width: "100%" }} onMount={(session) => this.captureEditorSession(session)}></Editor>
          </div>
        }
      ]}
    ></Layout>
    </div>
    </>
  }
}

ReactDOM.render(<App></App>, document.getElementById("root"));