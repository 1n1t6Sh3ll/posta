/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 22);
/******/ })
/************************************************************************/
/******/ ({

/***/ 22:
/***/ (function(module, exports) {

const handlers = new Set();

$$$SubScribeToPosta = handler => {
  console.log("new subscription from options page");
  handlers.add(handler);
};

var timer;

function refreshOptionsPage() {
  clearTimeout(timer);
  timer = setTimeout(() => {
    try {
      Array.from(handlers).forEach(h => h());
    } catch (error) {
      console.log(error);
    }
  }, 100);
}

class Bucket {
  constructor(ItemConstructor) {
    this.ItemConstructor = ItemConstructor;
    this._bucket = {};
  }

  add(id) {
    const {
      ItemConstructor
    } = this;
    if (!this._bucket[id]) this._bucket[id] = new ItemConstructor(id);
    return this._bucket[id];
  }

  set(id, item) {
    this._bucket[id] = item;
    return this._bucket[id];
  }

  get(id) {
    return this._bucket[id] || {
      get: () => ({}),
      set: () => ({
        get: () => {}
      })
    };
  }

  list(decay = 10 * 1000) {
    return Object.keys(this._bucket).map(k => this._bucket[k]); // .filter(i => !decay || !i.isDecayed(decay))
  }

}

class Item {
  constructor(id) {
    this.attributes = {};
    this.id = id;
    this.touch(true);
  }

  touch(modify) {
    this._json = modify ? undefined : this._json;
    this.lastSeen = Date.now();
    if (modify) refreshOptionsPage();
  }

  set(key, value) {
    this.touch(this.attributes[key] !== value);
    this.attributes[key] = value;
    return this;
  }

  isDecayed(decay) {
    return false;
    if (decay && this.lastSeen + decay < Date.now()) return true;
  }

  json() {
    this._json = this._json || this.get();
    return this._json;
  }

  get() {
    return {
      id: this.id,
      ...this.attributes
    };
  }

}

class TabFrame extends Item {
  constructor(tabFrameId) {
    super(tabFrameId);
    this.children = new Bucket(TabFrame);
    this.set("listeners", []);
  }

  addChild(child) {
    return this.children.set(child.id, child);
  }

  get windowId() {
    return windowsByTabAndFrameId.get(this.id).id;
  }

  get messages() {
    return messageByTabFrameId.get(this.id).messages || {
      messages: [],
      sent: 0,
      count: 0,
      received: 0
    };
  }

  get() {
    const {
      children,
      id
    } = this;
    return { ...super.get(),
      ...windowsByTabAndFrameId.get(id).get(),
      children: children.list()
    };
  }

}

class MessagesBucket extends Item {
  constructor(windowId) {
    super(windowId);
    this.messages = {
      messages: [],
      sent: 0,
      count: 0,
      received: 0
    };
  }

  addMessage(messageId, counter) {
    if (this.messages.messages.indexOf(messageId) !== -1) return;
    this.messages[counter]++;
    this.messages.count++;
    this.messages.messages.unshift(messageId);
    this.messages.messages = this.messages.messages.slice(0, 100); //to avoid denial of service

    this.messages.messages = Array.from(this.messages.messages);
    this.touch(true);
    refreshOptionsPage();
  }

  get() {
    return { ...this.messages,
      messages: this.messages.map(m => messagesByMessageId.get(m).get())
    };
  }

}

windowsByTabAndFrameId = new Bucket(TabFrame);
messagesByMessageId = new Bucket(Item);
messageByTabFrameId = new Bucket(MessagesBucket);
tabsFrames = new Bucket(TabFrame);

const receivedMessage = ({
  messageId,
  data,
  origin
}, tabId, frameId) => {
  let tabWindowId = `${tabId}::${frameId}`;
  messageByTabFrameId.add(tabWindowId).addMessage(messageId, "received");
  messagesByMessageId.add(messageId).set("receiver", tabWindowId).set("origin", origin).set("data", data);
};

const accountForMessage = ({
  messageId
}, tabId, frameId) => {
  let tabWindowId = `${tabId}::${frameId}`;
  messageByTabFrameId.add(tabWindowId).addMessage(messageId, "sent");
  messagesByMessageId.add(messageId).set("sender", tabWindowId);
};

const listeners = (message, tabId, frameId) => {
  const {
    listeners,
    windowId
  } = message;
  windowsByTabAndFrameId.add(`${tabId}::${frameId}`).set("listeners", listeners).set("windowId", windowId);
};

const topicHandlers = {
  "received-message": receivedMessage,
  "account-for-message": accountForMessage,
  listeners,
  "account-for-path": (message, tabId, frameId) => {
    let tabWindowId = `${tabId}::${frameId}`;
    let {
      path
    } = message;
    windowsByTabAndFrameId.add(tabWindowId).set("path", path);
  }
};

const processIncomingMessage = (message, tabId, frameId) => {
  let {
    topic
  } = message;
  if (!topicHandlers[topic]) return console.log(`TODO: handel ${topic} from ${tabId}:${frameId}`);
  topicHandlers[topic](message, tabId, frameId);
};

chrome.runtime.onMessage.addListener((message, sender, response) => {
  const {
    frameId,
    tab: {
      id
    }
  } = sender;
  if (!message) console.trace("empty message");

  try {
    processIncomingMessage(message, id, frameId);
  } catch (error) {
    console.log(error);
  }
});

const updateTabs = () => {
  chrome.tabs.query({}, allTabs => {
    let targetTabs = allTabs.filter(({
      url
    }) => !url.startsWith("chrome"));
    Promise.all(targetTabs.map(({
      id: tabId
    }) => new Promise((resolve, reject) => {
      chrome.webNavigation.getAllFrames({
        tabId
      }, frames => resolve({
        tabId,
        frames
      }));
    }))).then(updatedTabs => {
      tabsFrames = new Bucket(TabFrame);
      updatedTabs.forEach(({
        tabId,
        frames
      }) => {
        let topFrameIndex = frames.findIndex(({
          parentFrameId
        }) => parentFrameId === -1);
        var [{
          frameId,
          url
        }] = frames.splice(topFrameIndex, 1);
        let tabFrameId = `${tabId}::${frameId}`;
        var top = new TabFrame(tabFrameId);
        top.set("locationHref", url);
        windowsByTabAndFrameId.set(tabFrameId, top);
        tabsFrames.set(tabFrameId, top);
        frames.forEach(frame => {
          const {
            frameId,
            parentFrameId,
            url
          } = frame;
          let tabFrameId = `${tabId}::${frameId}`;
          let parentTabFrameId = `${tabId}::${parentFrameId}`;
          let windowFrame = windowsByTabAndFrameId.add(tabFrameId).set("locationHref", url);
          let parentWindowFrame = windowsByTabAndFrameId.add(parentTabFrameId);
          parentWindowFrame.addChild(windowFrame);
        });
      });
    });
  });
};

chrome.webNavigation.onDOMContentLoaded.addListener(updateTabs);
chrome.webNavigation.onCommitted.addListener(updateTabs);

/***/ })

/******/ });
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2JhY2tncm91bmQuanMiXSwibmFtZXMiOlsiaGFuZGxlcnMiLCJTZXQiLCIkJCRTdWJTY3JpYmVUb1Bvc3RhIiwiaGFuZGxlciIsImNvbnNvbGUiLCJsb2ciLCJhZGQiLCJ0aW1lciIsInJlZnJlc2hPcHRpb25zUGFnZSIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJBcnJheSIsImZyb20iLCJmb3JFYWNoIiwiaCIsImVycm9yIiwiQnVja2V0IiwiY29uc3RydWN0b3IiLCJJdGVtQ29uc3RydWN0b3IiLCJfYnVja2V0IiwiaWQiLCJzZXQiLCJpdGVtIiwiZ2V0IiwibGlzdCIsImRlY2F5IiwiT2JqZWN0Iiwia2V5cyIsIm1hcCIsImsiLCJJdGVtIiwiYXR0cmlidXRlcyIsInRvdWNoIiwibW9kaWZ5IiwiX2pzb24iLCJ1bmRlZmluZWQiLCJsYXN0U2VlbiIsIkRhdGUiLCJub3ciLCJrZXkiLCJ2YWx1ZSIsImlzRGVjYXllZCIsImpzb24iLCJUYWJGcmFtZSIsInRhYkZyYW1lSWQiLCJjaGlsZHJlbiIsImFkZENoaWxkIiwiY2hpbGQiLCJ3aW5kb3dJZCIsIndpbmRvd3NCeVRhYkFuZEZyYW1lSWQiLCJtZXNzYWdlcyIsIm1lc3NhZ2VCeVRhYkZyYW1lSWQiLCJzZW50IiwiY291bnQiLCJyZWNlaXZlZCIsIk1lc3NhZ2VzQnVja2V0IiwiYWRkTWVzc2FnZSIsIm1lc3NhZ2VJZCIsImNvdW50ZXIiLCJpbmRleE9mIiwidW5zaGlmdCIsInNsaWNlIiwibSIsIm1lc3NhZ2VzQnlNZXNzYWdlSWQiLCJ0YWJzRnJhbWVzIiwicmVjZWl2ZWRNZXNzYWdlIiwiZGF0YSIsIm9yaWdpbiIsInRhYklkIiwiZnJhbWVJZCIsInRhYldpbmRvd0lkIiwiYWNjb3VudEZvck1lc3NhZ2UiLCJsaXN0ZW5lcnMiLCJtZXNzYWdlIiwidG9waWNIYW5kbGVycyIsInBhdGgiLCJwcm9jZXNzSW5jb21pbmdNZXNzYWdlIiwidG9waWMiLCJjaHJvbWUiLCJydW50aW1lIiwib25NZXNzYWdlIiwiYWRkTGlzdGVuZXIiLCJzZW5kZXIiLCJyZXNwb25zZSIsInRhYiIsInRyYWNlIiwidXBkYXRlVGFicyIsInRhYnMiLCJxdWVyeSIsImFsbFRhYnMiLCJ0YXJnZXRUYWJzIiwiZmlsdGVyIiwidXJsIiwic3RhcnRzV2l0aCIsIlByb21pc2UiLCJhbGwiLCJyZXNvbHZlIiwicmVqZWN0Iiwid2ViTmF2aWdhdGlvbiIsImdldEFsbEZyYW1lcyIsImZyYW1lcyIsInRoZW4iLCJ1cGRhdGVkVGFicyIsInRvcEZyYW1lSW5kZXgiLCJmaW5kSW5kZXgiLCJwYXJlbnRGcmFtZUlkIiwic3BsaWNlIiwidG9wIiwiZnJhbWUiLCJwYXJlbnRUYWJGcmFtZUlkIiwid2luZG93RnJhbWUiLCJwYXJlbnRXaW5kb3dGcmFtZSIsIm9uRE9NQ29udGVudExvYWRlZCIsIm9uQ29tbWl0dGVkIl0sIm1hcHBpbmdzIjoiO1FBQUE7UUFDQTs7UUFFQTtRQUNBOztRQUVBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBO1FBQ0E7OztRQUdBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBO1FBQ0E7UUFDQSwwQ0FBMEMsZ0NBQWdDO1FBQzFFO1FBQ0E7O1FBRUE7UUFDQTtRQUNBO1FBQ0Esd0RBQXdELGtCQUFrQjtRQUMxRTtRQUNBLGlEQUFpRCxjQUFjO1FBQy9EOztRQUVBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQSx5Q0FBeUMsaUNBQWlDO1FBQzFFLGdIQUFnSCxtQkFBbUIsRUFBRTtRQUNySTtRQUNBOztRQUVBO1FBQ0E7UUFDQTtRQUNBLDJCQUEyQiwwQkFBMEIsRUFBRTtRQUN2RCxpQ0FBaUMsZUFBZTtRQUNoRDtRQUNBO1FBQ0E7O1FBRUE7UUFDQSxzREFBc0QsK0RBQStE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QjtBQUNBLGNBQUltQixpQkFBaUIsR0FBRzlELHNCQUFzQixDQUFDM0MsR0FBdkIsQ0FBMkJ1RyxnQkFBM0IsQ0FBeEI7QUFDQUUsMkJBQWlCLENBQUNqRSxRQUFsQixDQUEyQmdFLFdBQTNCO0FBQ0gsU0FYRDtBQVlILE9BckJEO0FBc0JILEtBaENEO0FBaUNILEdBbkNEO0FBb0NILENBckNEOztBQXVDQWhDLE1BQU0sQ0FBQ29CLGFBQVAsQ0FBcUJjLGtCQUFyQixDQUF3Qy9CLFdBQXhDLENBQW9ESyxVQUFwRDtBQUNBUixNQUFNLENBQUNvQixhQUFQLENBQXFCZSxXQUFyQixDQUFpQ2hDLFdBQWpDLENBQTZDSyxVQUE3QyxFIiwiZmlsZSI6ImJhY2tncm91bmQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMjIpO1xuIiwiY29uc3QgaGFuZGxlcnMgPSBuZXcgU2V0KCk7XHJcblxyXG5cclxuJCQkU3ViU2NyaWJlVG9Qb3N0YSA9IChoYW5kbGVyKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhcIm5ldyBzdWJzY3JpcHRpb24gZnJvbSBvcHRpb25zIHBhZ2VcIilcclxuICAgIGhhbmRsZXJzLmFkZChoYW5kbGVyKTtcclxufVxyXG5cclxudmFyIHRpbWVyO1xyXG5cclxuZnVuY3Rpb24gcmVmcmVzaE9wdGlvbnNQYWdlKCkge1xyXG4gICAgY2xlYXJUaW1lb3V0KHRpbWVyKVxyXG4gICAgdGltZXIgPSBzZXRUaW1lb3V0KCgpPT57XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgQXJyYXkuZnJvbShoYW5kbGVycykuZm9yRWFjaChoID0+IGgoKSlcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgICAgICB9XHJcbiAgICB9LDEwMClcclxuICAgIFxyXG59XHJcblxyXG5cclxuY2xhc3MgQnVja2V0IHtcclxuICAgIGNvbnN0cnVjdG9yKEl0ZW1Db25zdHJ1Y3Rvcikge1xyXG4gICAgICAgIHRoaXMuSXRlbUNvbnN0cnVjdG9yID0gSXRlbUNvbnN0cnVjdG9yO1xyXG4gICAgICAgIHRoaXMuX2J1Y2tldCA9IHt9XHJcbiAgICB9XHJcbiAgICBhZGQoaWQpIHtcclxuICAgICAgICBjb25zdCB7IEl0ZW1Db25zdHJ1Y3RvciB9ID0gdGhpcztcclxuICAgICAgICBpZiAoIXRoaXMuX2J1Y2tldFtpZF0pIHRoaXMuX2J1Y2tldFtpZF0gPSBuZXcgSXRlbUNvbnN0cnVjdG9yKGlkKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYnVja2V0W2lkXVxyXG4gICAgfVxyXG4gICAgc2V0KGlkLCBpdGVtKXtcclxuICAgICAgICB0aGlzLl9idWNrZXRbaWRdID0gaXRlbTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYnVja2V0W2lkXTtcclxuICAgIH1cclxuICAgIGdldChpZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9idWNrZXRbaWRdIHx8IHtcclxuICAgICAgICAgICAgZ2V0OiAoKSA9PiAoe30pLFxyXG4gICAgICAgICAgICBzZXQ6ICgpID0+ICh7IGdldDogKCkgPT4geyB9IH0pXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGxpc3QoZGVjYXkgPSAxMCAqIDEwMDApIHtcclxuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5fYnVja2V0KS5tYXAoayA9PiB0aGlzLl9idWNrZXRba10pXHJcbiAgICAgICAgLy8gLmZpbHRlcihpID0+ICFkZWNheSB8fCAhaS5pc0RlY2F5ZWQoZGVjYXkpKVxyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBJdGVtIHtcclxuICAgIGNvbnN0cnVjdG9yKGlkKSB7XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0ge307XHJcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xyXG4gICAgICAgIHRoaXMudG91Y2godHJ1ZSk7XHJcbiAgICB9XHJcbiAgICB0b3VjaChtb2RpZnkpIHtcclxuICAgICAgICB0aGlzLl9qc29uID0gbW9kaWZ5ID8gdW5kZWZpbmVkIDogdGhpcy5fanNvbjtcclxuICAgICAgICB0aGlzLmxhc3RTZWVuID0gRGF0ZS5ub3coKTtcclxuICAgICAgICBpZiAobW9kaWZ5KSByZWZyZXNoT3B0aW9uc1BhZ2UoKTtcclxuICAgIH1cclxuICAgIHNldChrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy50b3VjaCh0aGlzLmF0dHJpYnV0ZXNba2V5XSAhPT0gdmFsdWUpO1xyXG4gICAgICAgIHRoaXMuYXR0cmlidXRlc1trZXldID0gdmFsdWU7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgaXNEZWNheWVkKGRlY2F5KSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgaWYgKGRlY2F5ICYmICgodGhpcy5sYXN0U2VlbiArIGRlY2F5KSA8IERhdGUubm93KCkpKSByZXR1cm4gdHJ1ZVxyXG4gICAgfVxyXG5cclxuICAgIGpzb24oKSB7XHJcbiAgICAgICAgdGhpcy5fanNvbiA9IHRoaXMuX2pzb24gfHwgdGhpcy5nZXQoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fanNvbjtcclxuICAgIH1cclxuXHJcbiAgICBnZXQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgaWQ6dGhpcy5pZCxcclxuICAgICAgICAgICAgLi4udGhpcy5hdHRyaWJ1dGVzXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgVGFiRnJhbWUgZXh0ZW5kcyBJdGVtIHtcclxuICAgIGNvbnN0cnVjdG9yKHRhYkZyYW1lSWQpIHtcclxuICAgICAgICBzdXBlcih0YWJGcmFtZUlkKTtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuID0gbmV3IEJ1Y2tldChUYWJGcmFtZSlcclxuICAgICAgICB0aGlzLnNldChcImxpc3RlbmVyc1wiLCBbXSk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkQ2hpbGQoY2hpbGQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbi5zZXQoY2hpbGQuaWQsY2hpbGQpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB3aW5kb3dJZCgpe1xyXG4gICAgICAgIHJldHVybiB3aW5kb3dzQnlUYWJBbmRGcmFtZUlkLmdldCh0aGlzLmlkKS5pZFxyXG4gICAgfVxyXG5cclxuICAgIGdldCBtZXNzYWdlcyAoKXtcclxuICAgICAgICByZXR1cm4gbWVzc2FnZUJ5VGFiRnJhbWVJZC5nZXQodGhpcy5pZCkubWVzc2FnZXMgfHwge1xyXG4gICAgICAgICAgICBtZXNzYWdlczogW10sXHJcbiAgICAgICAgICAgIHNlbnQ6MCxcclxuICAgICAgICAgICAgY291bnQ6IDAsXHJcbiAgICAgICAgICAgIHJlY2VpdmVkOjBcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCAoKSB7XHJcbiAgICAgICAgY29uc3Qge2NoaWxkcmVuLGlkfSA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgLi4uc3VwZXIuZ2V0KCksXHJcbiAgICAgICAgICAgIC4uLndpbmRvd3NCeVRhYkFuZEZyYW1lSWQuZ2V0KGlkKS5nZXQoKSxcclxuICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuLmxpc3QoKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgTWVzc2FnZXNCdWNrZXQgZXh0ZW5kcyBJdGVtIHtcclxuICAgIGNvbnN0cnVjdG9yKHdpbmRvd0lkKSB7XHJcbiAgICAgICAgc3VwZXIod2luZG93SWQpO1xyXG4gICAgICAgIHRoaXMubWVzc2FnZXMgPSB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSxcclxuICAgICAgICAgICAgc2VudDowLFxyXG4gICAgICAgICAgICBjb3VudDogMCxcclxuICAgICAgICAgICAgcmVjZWl2ZWQ6MFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgYWRkTWVzc2FnZShtZXNzYWdlSWQsY291bnRlcikge1xyXG4gICAgICAgIGlmKHRoaXMubWVzc2FnZXMubWVzc2FnZXMuaW5kZXhPZihtZXNzYWdlSWQpICE9PSAtMSkgcmV0dXJuXHJcbiAgICAgICAgdGhpcy5tZXNzYWdlc1tjb3VudGVyXSsrO1xyXG4gICAgICAgIHRoaXMubWVzc2FnZXMuY291bnQrKztcclxuICAgICAgICB0aGlzLm1lc3NhZ2VzLm1lc3NhZ2VzLnVuc2hpZnQobWVzc2FnZUlkKTtcclxuICAgICAgICB0aGlzLm1lc3NhZ2VzLm1lc3NhZ2VzID0gdGhpcy5tZXNzYWdlcy5tZXNzYWdlcy5zbGljZSgwLCAxMDApOy8vdG8gYXZvaWQgZGVuaWFsIG9mIHNlcnZpY2VcclxuICAgICAgICB0aGlzLm1lc3NhZ2VzLm1lc3NhZ2VzID0gQXJyYXkuZnJvbSh0aGlzLm1lc3NhZ2VzLm1lc3NhZ2VzKVxyXG4gICAgICAgIHRoaXMudG91Y2godHJ1ZSlcclxuICAgICAgICByZWZyZXNoT3B0aW9uc1BhZ2UoKVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBnZXQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIC4uLnRoaXMubWVzc2FnZXMsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlczogdGhpcy5tZXNzYWdlcy5tYXAobT0+bWVzc2FnZXNCeU1lc3NhZ2VJZC5nZXQobSkuZ2V0KCkpXHJcbiAgICAgICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuXHJcbndpbmRvd3NCeVRhYkFuZEZyYW1lSWQgPSBuZXcgQnVja2V0KFRhYkZyYW1lKTtcclxubWVzc2FnZXNCeU1lc3NhZ2VJZCAgPSBuZXcgQnVja2V0KEl0ZW0pO1xyXG5tZXNzYWdlQnlUYWJGcmFtZUlkICA9IG5ldyBCdWNrZXQoTWVzc2FnZXNCdWNrZXQpO1xyXG5cclxudGFic0ZyYW1lcyA9IG5ldyBCdWNrZXQoVGFiRnJhbWUpO1xyXG5cclxuY29uc3QgcmVjZWl2ZWRNZXNzYWdlID0gKHsgbWVzc2FnZUlkLCBkYXRhLCBvcmlnaW4gfSx0YWJJZCwgZnJhbWVJZCkgPT4ge1xyXG4gICAgbGV0IHRhYldpbmRvd0lkID0gYCR7dGFiSWR9Ojoke2ZyYW1lSWR9YDtcclxuICAgIG1lc3NhZ2VCeVRhYkZyYW1lSWQuYWRkKHRhYldpbmRvd0lkKVxyXG4gICAgICAgIC5hZGRNZXNzYWdlKG1lc3NhZ2VJZCxcInJlY2VpdmVkXCIpXHJcbiAgICBcclxuICAgIG1lc3NhZ2VzQnlNZXNzYWdlSWQuYWRkKG1lc3NhZ2VJZClcclxuICAgICAgICAuc2V0KFwicmVjZWl2ZXJcIiwgdGFiV2luZG93SWQpXHJcbiAgICAgICAgLnNldChcIm9yaWdpblwiLG9yaWdpbilcclxuICAgICAgICAuc2V0KFwiZGF0YVwiLCBkYXRhKTtcclxufVxyXG5cclxuY29uc3QgYWNjb3VudEZvck1lc3NhZ2UgPSAoeyBtZXNzYWdlSWQgfSx0YWJJZCwgZnJhbWVJZCkgPT4ge1xyXG4gICAgbGV0IHRhYldpbmRvd0lkID0gYCR7dGFiSWR9Ojoke2ZyYW1lSWR9YDtcclxuICAgIG1lc3NhZ2VCeVRhYkZyYW1lSWQuYWRkKHRhYldpbmRvd0lkKVxyXG4gICAgICAgIC5hZGRNZXNzYWdlKG1lc3NhZ2VJZCxcInNlbnRcIilcclxuICAgIFxyXG4gICAgbWVzc2FnZXNCeU1lc3NhZ2VJZC5hZGQobWVzc2FnZUlkKVxyXG4gICAgICAgIC5zZXQoXCJzZW5kZXJcIiwgdGFiV2luZG93SWQpO1xyXG59XHJcblxyXG5jb25zdCBsaXN0ZW5lcnMgPSAobWVzc2FnZSwgdGFiSWQsIGZyYW1lSWQpID0+IHtcclxuICAgIGNvbnN0IHsgbGlzdGVuZXJzLCB3aW5kb3dJZCAgfSA9IG1lc3NhZ2U7XHJcbiAgICB3aW5kb3dzQnlUYWJBbmRGcmFtZUlkLmFkZChgJHt0YWJJZH06OiR7ZnJhbWVJZH1gKS5zZXQoXCJsaXN0ZW5lcnNcIixsaXN0ZW5lcnMpLnNldChcIndpbmRvd0lkXCIsIHdpbmRvd0lkKVxyXG59XHJcblxyXG5jb25zdCB0b3BpY0hhbmRsZXJzID0ge1xyXG4gICAgXCJyZWNlaXZlZC1tZXNzYWdlXCI6cmVjZWl2ZWRNZXNzYWdlLFxyXG4gICAgXCJhY2NvdW50LWZvci1tZXNzYWdlXCI6YWNjb3VudEZvck1lc3NhZ2UsXHJcbiAgICBsaXN0ZW5lcnMsXHJcbiAgICBcImFjY291bnQtZm9yLXBhdGhcIjogKG1lc3NhZ2UsIHRhYklkLCBmcmFtZUlkKT0+e1xyXG4gICAgICAgIGxldCB0YWJXaW5kb3dJZCA9IGAke3RhYklkfTo6JHtmcmFtZUlkfWA7XHJcbiAgICAgICAgbGV0IHtwYXRofSA9bWVzc2FnZTtcclxuICAgICAgICB3aW5kb3dzQnlUYWJBbmRGcmFtZUlkLmFkZCh0YWJXaW5kb3dJZCkuc2V0KFwicGF0aFwiLHBhdGgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuY29uc3QgcHJvY2Vzc0luY29taW5nTWVzc2FnZSA9IChtZXNzYWdlLCB0YWJJZCxmcmFtZUlkKSA9PiB7XHJcbiAgICBsZXQgeyB0b3BpYyB9ID0gbWVzc2FnZTtcclxuICAgIGlmICghdG9waWNIYW5kbGVyc1t0b3BpY10pIHJldHVybiBjb25zb2xlLmxvZyhgVE9ETzogaGFuZGVsICR7dG9waWN9IGZyb20gJHt0YWJJZH06JHtmcmFtZUlkfWApXHJcbiAgICB0b3BpY0hhbmRsZXJzW3RvcGljXShtZXNzYWdlLCB0YWJJZCxmcmFtZUlkKVxyXG59XHJcblxyXG5jaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoKG1lc3NhZ2UsIHNlbmRlciwgcmVzcG9uc2UpID0+IHtcclxuICAgIGNvbnN0IHsgXHJcbiAgICAgICAgZnJhbWVJZCxcclxuICAgICAgICB0YWI6IHtcclxuICAgICAgICAgICAgaWRcclxuICAgICAgICB9IH0gPSBzZW5kZXJcclxuXHJcbiAgICBpZiAoIW1lc3NhZ2UpIGNvbnNvbGUudHJhY2UoXCJlbXB0eSBtZXNzYWdlXCIpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBwcm9jZXNzSW5jb21pbmdNZXNzYWdlKG1lc3NhZ2UsIGlkLCBmcmFtZUlkKVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgIH1cclxufSlcclxuXHJcblxyXG5cclxuY29uc3QgdXBkYXRlVGFicyA9ICgpID0+IHtcclxuICAgIGNocm9tZS50YWJzLnF1ZXJ5KHt9LCAoYWxsVGFicykgPT4ge1xyXG4gICAgICAgIGxldCB0YXJnZXRUYWJzID0gYWxsVGFicy5maWx0ZXIoKHsgdXJsIH0pID0+ICF1cmwuc3RhcnRzV2l0aChcImNocm9tZVwiKSk7XHJcbiAgICAgICAgUHJvbWlzZS5hbGwoXHJcbiAgICAgICAgICAgIHRhcmdldFRhYnMubWFwKCh7IGlkOiB0YWJJZCB9KSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjaHJvbWUud2ViTmF2aWdhdGlvbi5nZXRBbGxGcmFtZXMoeyB0YWJJZCB9LCAoZnJhbWVzKSA9PiByZXNvbHZlKHtcclxuICAgICAgICAgICAgICAgICAgICB0YWJJZCxcclxuICAgICAgICAgICAgICAgICAgICBmcmFtZXNcclxuICAgICAgICAgICAgICAgIH0pKVxyXG4gICAgICAgICAgICB9KSlcclxuXHJcbiAgICAgICAgKS50aGVuKCh1cGRhdGVkVGFicykgPT4ge1xyXG4gICAgICAgICAgICB0YWJzRnJhbWVzID0gbmV3IEJ1Y2tldChUYWJGcmFtZSk7XHJcbiAgICAgICAgICAgIHVwZGF0ZWRUYWJzLmZvckVhY2goKHsgdGFiSWQsIGZyYW1lcyB9KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdG9wRnJhbWVJbmRleCA9IGZyYW1lcy5maW5kSW5kZXgoKHtwYXJlbnRGcmFtZUlkfSk9PnBhcmVudEZyYW1lSWQ9PT0tMSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgW3tmcmFtZUlkLHVybH1dID0gZnJhbWVzLnNwbGljZSh0b3BGcmFtZUluZGV4LDEpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHRhYkZyYW1lSWQgPSBgJHt0YWJJZH06OiR7ZnJhbWVJZH1gO1xyXG4gICAgICAgICAgICAgICAgdmFyIHRvcCA9ICBuZXcgVGFiRnJhbWUodGFiRnJhbWVJZCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRvcC5zZXQoXCJsb2NhdGlvbkhyZWZcIiwgdXJsKTtcclxuICAgICAgICAgICAgICAgIHdpbmRvd3NCeVRhYkFuZEZyYW1lSWQuc2V0KHRhYkZyYW1lSWQsdG9wKTtcclxuICAgICAgICAgICAgICAgIHRhYnNGcmFtZXMuc2V0KHRhYkZyYW1lSWQsIHRvcClcclxuICAgICAgICAgICAgICAgIGZyYW1lcy5mb3JFYWNoKGZyYW1lID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudEZyYW1lSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybFxyXG4gICAgICAgICAgICAgICAgICAgIH0gPSBmcmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdGFiRnJhbWVJZCA9IGAke3RhYklkfTo6JHtmcmFtZUlkfWA7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBhcmVudFRhYkZyYW1lSWQgPSBgJHt0YWJJZH06OiR7cGFyZW50RnJhbWVJZH1gO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB3aW5kb3dGcmFtZSA9IHdpbmRvd3NCeVRhYkFuZEZyYW1lSWQuYWRkKHRhYkZyYW1lSWQpLnNldChcImxvY2F0aW9uSHJlZlwiLCB1cmwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBwYXJlbnRXaW5kb3dGcmFtZSA9IHdpbmRvd3NCeVRhYkFuZEZyYW1lSWQuYWRkKHBhcmVudFRhYkZyYW1lSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudFdpbmRvd0ZyYW1lLmFkZENoaWxkKHdpbmRvd0ZyYW1lKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgIH0pXHJcbn1cclxuXHJcbmNocm9tZS53ZWJOYXZpZ2F0aW9uLm9uRE9NQ29udGVudExvYWRlZC5hZGRMaXN0ZW5lcih1cGRhdGVUYWJzKVxyXG5jaHJvbWUud2ViTmF2aWdhdGlvbi5vbkNvbW1pdHRlZC5hZGRMaXN0ZW5lcih1cGRhdGVUYWJzKSJdLCJzb3VyY2VSb290IjoiIn0=
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJiYWNrZ3JvdW5kLmpzIiwic291cmNlUm9vdCI6IiJ9